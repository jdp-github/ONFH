<view class="cu-custom" style="height:{{CustomBar}}px;">
    <view class="cu-bar fixed bg-gradual-green" style="height:{{CustomBar}}px;padding-top:{{StatusBar}}px;">
        <navigator class='action border-custom' open-type="navigateBack" delta="1" hover-class="none" style='width:{{Custom.width}}px;height:{{Custom.height}}px;margin-left:calc(750rpx - {{Custom.right}}px)'>
            <text class='icon-back'></text>
            <text class='icon-homefill'></text>
        </navigator>
        <view class='content' style='top:{{StatusBar}}px;'>病历列表</view>
    </view>
</view>

<!-- 搜索 -->
<view class="cu-bar bg-white search fixed" style="top:{{CustomBar}}px;">
    <view class='search-form round'>
        <text class="icon-search"></text>
        <input type="text" placeholder="搜索病厉、名称、关键字" confirm-type="search" value="{{searchValue}}" bindinput="onSearchChange"></input>
    </view>
    <view class='action'>
        <button class='cu-btn bg-green shadow-blur round' bindtap="onSearch">搜索</button>
    </view>
</view>

<!-- 列表 -->
<scroll-view scroll-y class="indexes margin-bottom" scroll-into-view="indexes-{{listCurID}}" style='padding-top:120rpx;height:calc(100vh - {{CustomBar}}px)' scroll-with-animation="true" enable-back-to-top="true">
    <view class="cu-list menu menu-avatar">

        <!-- 按钮行 -->
        <view style='display:flex;flex-direction:row'>
            <view class="flex-sub">
                <button class='cu-btn bg-green shadow margin-btn block' bindtap="onAddCase">
                    添加病历
                </button>
            </view>
            <view class="flex-sub">
                <button class='cu-btn bg-green shadow margin-btn block' bindtap="onRefresh">
                    刷新列表
                </button>
            </view>
        </view>

        <!-- 筛选 -->
        <view style="display:flex;flex-direction:row;margin-top:10px;margin-bottom:10px;padding-right:10px">
            <view style="width:280px;">
                <view class="canvas-container">
                    <view style="display:flex;flex-direction: row; align-items:baseline;font-size:40rpx;">
                        共
                        <view style="font-size:80rpx;color:#39b54a;margin-right:10rpx;margin-left:10rpx;">{{stateCount}}</view>例
                    </view>
                    <view style="margin-top:20rpx;">{{stateText}}</view>
                    <!-- <div class="c100 p{{40}} small green">
                        <span>{{caseCount}}/{{kuanCount}}</span>
                        <div class="slice">
                            <div class="bar"></div>
                            <div class="fill"></div>
                        </div>
                    </div> -->
                </view>
            </view>
            <view>
                <view class="grid col-{{2}} text-center" style="justify-content: space-between">
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="1" value="{{fenqiIndex}}" range="{{fenqiArr}}">
                            <view class="picker">
                                {{fenqiArr[fenqiIndex]}}
                            </view>
                        </picker>
                    </view>
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="2" value="{{leixingIndex}}" range="{{leixingArr}}">
                            <view class="picker">
                                {{leixingArr[leixingIndex]}}
                            </view>
                        </picker>
                    </view>
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="3" value="{{ziliaoIndex}}" range="{{ziliaoArr}}">
                            <view class="picker">
                                {{ziliaoArr[ziliaoIndex]}}
                            </view>
                        </picker>
                    </view>
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="4" value="{{zhongjieIndex}}" range="{{zhongjieArr}}">
                            <view class="picker">
                                {{zhongjieArr[zhongjieIndex]}}
                            </view>
                        </picker>
                    </view>
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="5" value="{{chaoshiIndex}}" range="{{chaoshiArr}}">
                            <view class="picker">
                                {{chaoshiArr[chaoshiIndex]}}
                            </view>
                        </picker>
                    </view>
                    <view class="filter-container">
                        <picker class="filter-picker" bindchange="PickerChange" data-type="6" value="{{statisIndex}}" range="{{statisArr}}">
                            <view class="picker">
                                {{statisArr[statisIndex]}}
                            </view>
                        </picker>
                    </view>
                </view>
            </view>
        </view>

        <!-- item -->
        <view view class="cu-item {{modalName=='move-box-'+ index?'move-cur':''}}" wx:for="{{caseList}}" wx:key="" bindtouchstart='ListTouchStart' bindtouchmove='ListTouchMove' bindtouchend='ListTouchEnd' data-target="move-box-{{index}}" bindtap="onLookCase"
            data-case="{{item}}">
            <view class='content'>
                <view class="flex">
                    <!-- 头像 -->
                    <view class='flex-sub radius' style="padding-right: 30rpx;">
                        <view class="avatar-special bg-grey radius" style="padding-top: 10rpx;">
                            <view class="flex-sub avatar-text-small">{{item.patient_name}}</view>
                            <view class="flex-sub text-small">ID: {{item.case_no}}</view>
                            <view class="flex-sub text-small">{{item.create_time}}</view>
                        </view>
                    </view>

                    <view class='flex-treble radius text-gray'>
                        <!-- 第一行 -->
                        <view class="flex-sub text-small">
                            <div class="flex">
                                <view class="flex-sub">侧别</view>
                                <view class="flex-sub" style="margin-left:-25px">首诊情况</view>
                                <view class="flex-sub">末次随访状态</view>
                            </div>
                        </view>
                        <!-- 线 -->
                        <view style="height:1px;background:#288bb9;margin-top:3px;margin-bottom:3px" />
                        <!-- 第二行 -->
                        <view class="flex-sub text-small">
                            <div class="flex">
                                <view class="flex-sub">左髋</view>
                                <view class="flex-sub">{{item.arco_left}}</view>
                                <view class="flex-sub">{{item.leixing_left}}</view>
                                <view class="flex-sub">{{item.suifang_left}}</view>
                                <view class="flex-sub">{{item.sfqk_left}}（月）</view>
                            </div>
                        </view>
                        <!-- 第三行 -->
                        <view class="flex-sub text-small">
                            <div class="flex">
                                <view class="flex-sub">右髋</view>
                                <view class="flex-sub">{{item.arco_right}}</view>
                                <view class="flex-sub">{{item.leixing_right}}</view>
                                <view class="flex-sub">{{item.suifang_right}}</view>
                                <view class="flex-sub">{{item.sfqk_right}}（月）</view>
                            </div>
                        </view>
                    </view>
                </view>
            </view>

            <view class='move'>
                <view class='bg-olive' data-case="{{item}}" catchtap="onEditCase">编辑</view>
                <!-- <view class='bg-cyan' data-case="{{item}}" bindtap="onLookCase">查看</view> -->
                <view class='bg-red' data-case="{{item}}" catchtap='onDeleCase' hidden='true' disabled="{{item.delete_button == 0}}">删除</view>
            </view>
        </view>
    </view>
</scroll-view>


<view class='load-progress {{loadProgress!=0?"show":"hide"}}' style="top:{{CustomBar}}px;">
    <view class='load-progress-bar bg-green' style="transform: translate3d(-{{100-loadProgress}}%, 0px, 0px);"></view>
    <view class='load-progress-spinner text-green'></view>
</view>
<view class='cu-load load-modal' wx:if="{{loadModal}}">
    <view class='gray-text'>处理中...</view>
</view>
<view class="load-curtain" wx:if="{{loadProgress!=0}}"></view>
<!-- dialog -->
<view class="cu-modal {{modalName=='ErrModal'?'show':''}}">
    <view class="cu-dialog">
        <view class="cu-bar bg-white justify-end">
            <view class='content'>无法操作</view>
            <view class='action' bindtap='hideModal'>
                <text class='icon-close text-red'></text>
            </view>
        </view>
        <view class='padding-xl'>
            <view class='flex-sub text-center'>
                <view class='solid-bottom text-sl padding'>
                    <text class='icon-warnfill text-red'></text>
                </view>
                <view class='padding'>{{errMsg}}</view>
            </view>
        </view>
    </view>
</view>
<view class="cu-modal {{modalName=='DeleteCaseModal'?'show':''}}">
    <view class="cu-dialog">
        <view class="cu-bar bg-white justify-end">
            <view class='content'>删除病历</view>
            <view class='action' bindtap='hideModal'>
                <text class='icon-close text-red'></text>
            </view>
        </view>
        <view class='padding-xl'>
            <view class='flex-sub text-center'>
                <view class='solid-bottom text-sl padding'>
                    <text class='icon-warnfill text-red'></text>
                </view>
                <view class='padding'>是否删除{{selectedCase.patient_name}}的病历</view>
            </view>
        </view>
        <view class="cu-bar bg-white justify-end">
            <view class='action'>
                <button class='cu-btn line-green text-green' bindtap='hideModal'>取消</button>
                <button class='cu-btn bg-green margin-left-15' bindtap='hideModal' bindtap="deleCase">确定</button>
            </view>
        </view>
    </view>
</view>